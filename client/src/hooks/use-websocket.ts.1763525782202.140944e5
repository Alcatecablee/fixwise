{
  "originalPath": "../client/src/hooks/use-websocket.ts",
  "timestamp": 1763525782202,
  "hash": "140944e5",
  "operation": "cli-fix",
  "content": "import { useEffect, useRef, useState } from 'react';\n\nexport interface WebSocketMessage {\n  type: 'log' | 'run-started' | 'run-completed' | 'run-failed' | 'issue-detected' | 'run-updated';\n  data: any;\n}\n\nexport function useWebSocket(onMessage?: (message: WebSocketMessage) => void) {\n  const [isConnected, setIsConnected] = useState(false);\n  const wsRef = useRef<WebSocket | null>(null);\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout>();\n\n  useEffect(() => {\n    const connect = () => {\n      const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n      const wsUrl = `${protocol}//${window.location.host}/ws`;\n      \n      const ws = new WebSocket(wsUrl);\n      wsRef.current = ws;\n\n      ws.onopen = () => {\n        console.log('WebSocket connected');\n        setIsConnected(true);\n      };\n\n      ws.onmessage = (event) => {\n        try {\n          const message: WebSocketMessage = JSON.parse(event.data);\n          onMessage?.(message);\n        } catch (error) {\n          console.error('Failed to parse WebSocket message:', error);\n        }\n      };\n\n      ws.onclose = () => {\n        console.log('WebSocket disconnected');\n        setIsConnected(false);\n        \n        // Attempt to reconnect after 3 seconds\n        reconnectTimeoutRef.current = setTimeout(() => {\n          console.log('Attempting to reconnect...');\n          connect();\n        }, 3000);\n      };\n\n      ws.onerror = (error) => {\n        console.error('WebSocket error:', error);\n      };\n    };\n\n    connect();\n\n    return () => {\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n      if (wsRef.current) {\n        wsRef.current.close();\n      }\n    };\n  }, []);\n\n  return { isConnected, ws: wsRef.current };\n}\n"
}